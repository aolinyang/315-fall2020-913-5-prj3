<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  </head>

  <body>
  <center id="exp-form"></center>
  <button onclick="addExperience()">Add Experience</button>
  <button onclick="saveExperiences()">Submit</button>

  <script src="https://unpkg.com/js-logger/src/logger.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    var numCompanies = 0;

    function getInput(companyNum, companyObj) {
      var input = "\
    <h4> Experience for Company " + companyNum + " </h4>\
         company:\
            <input type = \"text\" name = \"company-" + companyNum + "\" id=\"company-" + companyNum + "\" value = \"" + companyObj.company + "\" maxlength = \"200\" />\
         <br>\
         <br>\
\
         position:\
            <input type = \"text\" name = \"position-" + companyNum + "\" id=\"position-" + companyNum + "\" value = \"" + companyObj.position + "\" maxlength = \"200\" />\
         <br>\
         <br>\
         Start date:\
            <input type = \"date\" name = \"startDate-" + companyNum + "\" id=\"startDate-" + companyNum + "\" value = \"" + companyObj.startDate + "\" />\
         End date:\
            <input type = \"date\" name = \"endDate-" + companyNum + "\" id=\"endDate-" + companyNum + "\" value = \"" + companyObj.endDate + "\" />\
         <br>\
         <br>\
         description:\
            <input type = \"text\" name = \"description-" + companyNum + "\" id=\"description-" + companyNum + "\" value = \"" + companyObj.description + "\" maxlength = \"1000\"/>\
         <br>\
         <br>\
         department:\
         <select name=\"department-" + companyNum + "\" id=\"department-" + companyNum + "\">\
            <option value=\"tech\">tech</option>\
            <option value=\"HR\">HR</option>\
            <option value=\"business\">business</option>\
            <option value=\"other\">other</option>\
        </select>\
        <br>\
        <br>\
        supervisor:\
          <input type = \"text\" name = \"supervisor-" + companyNum + "\" id= \"supervisor-" + companyNum + "\" value = \"" + companyObj.supervisor + "\" maxlength = \"200\" />\
        <br>\
        <br>\
        contactEmail:\
          <input type = \"text\" name = \"contactEmail-" + companyNum + "\" id= \"contactEmail-" + companyNum + "\" value = \"" + companyObj.contactEmail + "\" maxlength = \"200\" />\
        <br>\
        <br>";
      return input;
    }

    function addExperience() {
      const emptyObj = {
        company: "",
        position: "",
        department: "",
        description: "",
        supervisor: "",
        contactEmail: "",
        startDate: "",
        endDate: "",
      }
      var input = getInput(numCompanies, emptyObj);
      $(input).appendTo("#exp-form");
      numCompanies++;
    }

    function saveExperiences(){
        var expArr = [];
        for (var i = 0; i < numCompanies; i++) {
            const expObj = {
              company : $("#company-" + i).val(),
              position : $("#position-" + i).val(),
              department : $("#department-" + i).val(),
              description : $("#description-" + i).val(),
              supervisor : $("#supervisor-" + i).val(),
              contactEmail : $("#contactEmail-" + i).val(),
              startDate: $("#startDate-" + i).val(),
              endDate: $("#endDate-" + i).val(),
            };
            expArr.push(expObj);
        }
        
        google.script.run.saveExperience(JSON.stringify(expArr));
        // google.script.run.putExperienceInfo(company,position,description,department,supervisor,contactEmail);
        // document.getElementById("msg").innerHTML = "Insert successfully. Please close the windows";
        // window.close();
    }

    function initialize(stringifiedExp) {
        var expList = JSON.parse(stringifiedExp);
        numCompanies = expList.length;
        expList.forEach(function(exp, counter) {
          const input = getInput(counter, exp);
          $(input).appendTo("#exp-form");
        });
    }

    $(document).ready(function() {
        google.script.run.withSuccessHandler(initialize).getExperience(); 
    });

    </script>
  </body>
</html>
