<head>
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
</head>

<div id="skills-form"></div>
<button onclick="addSkill()">Add Skill</button>
<button onclick="saveSkills()">Save</button>
<p id="psk"> </p> 

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  var numSkills = 0;

  function getInputField(skillName, skillLevel, id) {
    var input = "\
      <div class=\"skill-inline\">\
        <label for=\"skillName\">Skill: </label>\
        <input type=\"text\" id=\"skill-name-" + id + "\" name=\"skillName\" value=\"" + skillName + "\">\
        <label for=\"skillLevel\">Proficiency: </label>\
        <select id=\"skill-level-" + id + "\" name=\"skillLevel\">";
    for (var i = 1; i <= 10; i++) {
      input += "<option value=\"" + i + "\"";
      if (i == skillLevel) {
        input += " selected";
      }
      input += ">" + i + "</option>";
    }
    input += "</select></div>";
    return input;
  }

  function addSkill() {
    const input = getInputField("", -1, numSkills);
    $(input).appendTo("#skills-form");
    numSkills++;
  }

  function saveSkills() {
    var skillArr = [];
    for (var i = 0; i < numSkills; i++) {
      var skillObj = {
        name: $("#skill-name-" + i).val(),
        level: $("#skill-level-" + i).val()
      };
      skillArr.push(skillObj);
    }
    google.script.run.saveAllSkills(JSON.stringify(skillArr));
    
    document.getElementById("psk").innerHTML = "Your skills have been saved.You may close the window";
  }

  function initialize(stringifiedArr) {
    var skills = JSON.parse(stringifiedArr);
    numSkills = skills.length;
    skills.forEach(function(skill, counter) {
      const input = getInputField(skill.name, skill.level, counter);
      $(input).appendTo("#skills-form");
    });
  }

  function printFail(error) {
    console.log("ERROR: " + error);
  }

  $(document).ready(function() {
    google.script.run.withSuccessHandler(initialize).withFailureHandler(printFail).getAllSkills(); 
  });
</script>
